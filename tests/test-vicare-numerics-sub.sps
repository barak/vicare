;;; -*- coding: utf-8-unix -*-
;;;
;;;Part of: Vicare Scheme
;;;Contents: tests for numerics functions: sub
;;;Date: Wed Nov 28, 2012
;;;
;;;Abstract
;;;
;;;
;;;
;;;Copyright (C) 2012 Marco Maggi <marco.maggi-ipsu@poste.it>
;;;
;;;This program is free software:  you can redistribute it and/or modify
;;;it under the terms of the  GNU General Public License as published by
;;;the Free Software Foundation, either version 3 of the License, or (at
;;;your option) any later version.
;;;
;;;This program is  distributed in the hope that it  will be useful, but
;;;WITHOUT  ANY   WARRANTY;  without   even  the  implied   warranty  of
;;;MERCHANTABILITY or  FITNESS FOR  A PARTICULAR  PURPOSE.  See  the GNU
;;;General Public License for more details.
;;;
;;;You should  have received a  copy of  the GNU General  Public License
;;;along with this program.  If not, see <http://www.gnu.org/licenses/>.
;;;


#!r6rs
(import (vicare)
  (ikarus system $ratnums)
  (ikarus system $compnums)
  (ikarus system $numerics)
  (vicare checks))

(check-set-mode! 'report-failed)
(check-display "*** testing Vicare numerics functions: subtraction\n")


;;;; helpers

(define C make-rectangular)
(define R real-part)
(define I imag-part)

(define-syntax make-test
  (syntax-rules ()
    ((_ ?safe-fun ?unsafe-fun)
     (syntax-rules ()
       ((_ ?op1 ?op2 ?expected-result)
	(begin
	  (check (?safe-fun   ?op1 ?op2)	=> ?expected-result)
	  (check (?unsafe-fun ?op1 ?op2)	=> ?expected-result)
	  (check (?safe-fun   ?op1 ?op2)	=> (?unsafe-fun ?op1 ?op2))
	  ))))))

(define-syntax make-flonum-test
  (syntax-rules ()
    ((_ ?safe-fun ?unsafe-fun)
     (syntax-rules ()
       ((_ ?op1 ?op2 ?expected-result)
	(begin
	  (check (?safe-fun   ?op1 ?op2)	(=> flonum=?) ?expected-result)
	  (check (?unsafe-fun ?op1 ?op2)	(=> flonum=?) ?expected-result)
	  (check (?safe-fun   ?op1 ?op2)	(=> flonum=?) (?unsafe-fun ?op1 ?op2))
	  ))))))

(define-syntax make-cflonum-test
  (syntax-rules ()
    ((_ ?safe-fun ?unsafe-fun)
     (syntax-rules ()
       ((_ ?op1 ?op2 ?expected-result)
	(begin
	  (check (?safe-fun   ?op1 ?op2)	(=> cflonum=?) ?expected-result)
	  (check (?unsafe-fun ?op1 ?op2)	(=> cflonum=?) ?expected-result)
	  (check (?safe-fun   ?op1 ?op2)	(=> cflonum=?) (?unsafe-fun ?op1 ?op2))
	  ))))))

(define-syntax make-compnum-test
  (syntax-rules ()
    ((_ ?safe-fun ?unsafe-fun)
     (syntax-rules ()
       ((_ ?op1 ?op2 ?expected-result)
	(begin
	  (check (?safe-fun   ?op1 ?op2)	(=> compnum=?) ?expected-result)
	  (check (?unsafe-fun ?op1 ?op2)	(=> compnum=?) ?expected-result)
	  (check (?safe-fun   ?op1 ?op2)	(=> compnum=?) (?unsafe-fun ?op1 ?op2))
	  ))))))

(define-syntax make-inexact-test
  (syntax-rules ()
    ((_ ?safe-fun ?unsafe-fun)
     (syntax-rules ()
       ((_ ?op1 ?op2 ?expected-result)
	(begin
	  (check (?safe-fun   ?op1 ?op2)	(=> inexact=?) ?expected-result)
	  (check (?unsafe-fun ?op1 ?op2)	(=> inexact=?) ?expected-result)
	  (check (?safe-fun   ?op1 ?op2)	(=> inexact=?) (?unsafe-fun ?op1 ?op2))
	  ))))))

;;; --------------------------------------------------------------------

(define (flonum=? x y)
  (cond ((flnan? x)
	 (flnan? y))
	((flzero?/positive x)
	 (flzero?/positive y))
	((flzero?/negative x)
	 (flzero?/negative y))
	((fl=? x y))))

(define (cflonum=? x y)
  (and (flonum=? (real-part x) (real-part y))
       (flonum=? (imag-part x) (imag-part y))))

(define (compnum=? x y)
  (cond ((and (cflonum? x)
	      (cflonum? y))
	 (cflonum=? x y))
	((and (flonum? x)
	      (flonum? y))
	 (flonum=? x y))
	(else
	 (= x y))))

;;; --------------------------------------------------------------------

(define (inexact=? x y)
  (cond ((and (cflonum? x)
	      (cflonum? y))
	 (cflonum-quasi=? x y))
	((and (flonum? x)
	      (flonum? y))
	 (flonum-quasi=? x y))
	(else
	 (= x y))))

(define (flonum-quasi=? x y)
  (cond ((flnan? x)
	 (flnan? y))
	((flzero?/positive x)
	 (flzero?/positive y))
	((flzero?/negative x)
	 (flzero?/negative y))
	(else
	 (fl<? (flabs (fl- x y)) 1e-8))))

(define (cflonum-quasi=? x y)
  (and (flonum-quasi=? (real-part x) (real-part y))
       (flonum-quasi=? (imag-part x) (imag-part y))))


;;;; constants

(define GREATEST-FX	+536870911)
(define LEAST-FX	-536870912)

;;; --------------------------------------------------------------------

(define FX1		+1)
(define FX2		-1)
(define FX3		GREATEST-FX)
(define FX4		LEAST-FX)

;;; --------------------------------------------------------------------

(define BN1		+536870912) ;GREATEST-FX + 1
(define BN2		+536871011) ;GREATEST-FX + 100
(define BN3		-536870913) ;LEAST-FX - 1
(define BN4		-536871012) ;LEAST-FX - 100

;;; --------------------------------------------------------------------

(define RN01		1/123			#;(/ FX1 123))
(define RN02		-1/123			#;(/ FX2 123))
(define RN03		-1/123			#;(/ FX2 123))
(define RN04		-536870912/123		#;(/ FX4 123))

(define RN05		1/536870912		#;(/ FX1 BN1))
(define RN06		-1/536870912		#;(/ FX2 BN1))
(define RN07		536870911/536870912	#;(/ FX3 BN1))
;;(define RN08		-1			#;(/ FX4 BN1)) ;not a ratnum

(define RN09		1/536871011		#;(/ FX1 BN2))
(define RN10		-1/536871011		#;(/ FX2 BN2))
(define RN11		536870911/536871011	#;(/ FX3 BN2))
(define RN12		-536870912/536871011	#;(/ FX4 BN2))

(define RN13		-1/536870913		#;(/ FX1 BN3))
(define RN14		1/536870913		#;(/ FX2 BN3))
(define RN15		-536870911/536870913	#;(/ FX3 BN3))
(define RN16		536870912/536870913	#;(/ FX4 BN3))

(define RN17		-1/536871012		#;(/ FX1 BN4))
(define RN18		1/536871012		#;(/ FX2 BN4))
(define RN19		-536870911/536871012	#;(/ FX3 BN4))
(define RN20		134217728/134217753	#;(/ FX4 BN4))

;;(define RN21		536870912		#;(/ BN1 FX1)) ;not a ratnum
;;(define RN22		536871011		#;(/ BN2 FX1)) ;not a ratnum
;;(define RN23		-536870913		#;(/ BN3 FX1)) ;not a ratnum
;;(define RN24		-536871012		#;(/ BN4 FX1)) ;not a ratnum

;;(define RN25		-536870912		#;(/ BN1 FX2)) ;not a ratnum
;;(define RN26		-536871011		#;(/ BN2 FX2)) ;not a ratnum
;;(define RN27		536870913		#;(/ BN3 FX2)) ;not a ratnum
;;(define RN28		536871012		#;(/ BN4 FX2)) ;not a ratnum

(define RN29		536870912/536870911	#;(/ BN1 FX3))
(define RN30		536871011/536870911	#;(/ BN2 FX3))
(define RN31		-536870913/536870911	#;(/ BN3 FX3))
(define RN32		-536871012/536870911	#;(/ BN4 FX3))

;;(define RN33		-1			#;(/ BN1 FX4)) ;not a ratnum
(define RN34		-536871011/536870912	#;(/ BN2 FX4))
(define RN35		536870913/536870912	#;(/ BN3 FX4))
(define RN36		134217753/134217728	#;(/ BN4 FX4))

;;; --------------------------------------------------------------------

(define FL1		+0.0)
(define FL2		-0.0)
(define FL3		+2.123)
(define FL4		-2.123)
(define FL5		+inf.0)
(define FL6		-inf.0)
(define FL7		+nan.0)

;;; --------------------------------------------------------------------

(define CFL01		+0.0+0.0i)
(define CFL02		-0.0+0.0i)
(define CFL03		+0.0-0.0i)
(define CFL04		-0.0-0.0i)

(define CFL05		-1.2-0.0i)
(define CFL06		-1.2+0.0i)
(define CFL07		+0.0-1.2i)
(define CFL08		-0.0-1.2i)

(define CFL09		-1.2-inf.0i)
(define CFL10		-1.2+inf.0i)
(define CFL11		+inf.0-1.2i)
(define CFL12		-inf.0-1.2i)

(define CFL13		-1.2-nan.0i)
(define CFL14		-1.2+nan.0i)
(define CFL15		+nan.0-1.2i)
(define CFL16		-nan.0-1.2i)


(parametrise ((check-test-name	'fixnums))

  (let-syntax ((test (make-test - $sub-fixnum-fixnum)))
    (test 0	0		0)
    (test 0	+1		-1)
    (test +1	0		+1)
    (test 0	-1		+1)
    (test -1	0		-1)

    (test FX1 FX1 0)
    (test FX2 FX1 -2)
    (test FX3 FX1 536870910)
    (test FX4 FX1 -536870913)
    (test FX1 FX2 2)
    (test FX2 FX2 0)
    (test FX3 FX2 536870912)
    (test FX4 FX2 -536870911)
    (test FX1 FX3 -536870910)
    (test FX2 FX3 -536870912)
    (test FX3 FX3 0)
    (test FX4 FX3 -1073741823)
    (test FX1 FX4 536870913)
    (test FX2 FX4 536870911)
    (test FX3 FX4 1073741823)
    (test FX4 FX4 0)
    #f)

  (let-syntax ((test (make-test - $sub-fixnum-bignum)))
    (test FX1 BN1 -536870911)
    (test FX2 BN1 -536870913)
    (test FX3 BN1 -1)
    (test FX4 BN1 -1073741824)
    (test FX1 BN2 -536871010)
    (test FX2 BN2 -536871012)
    (test FX3 BN2 -100)
    (test FX4 BN2 -1073741923)
    (test FX1 BN3 536870914)
    (test FX2 BN3 536870912)
    (test FX3 BN3 1073741824)
    (test FX4 BN3 1)
    (test FX1 BN4 536871013)
    (test FX2 BN4 536871011)
    (test FX3 BN4 1073741923)
    (test FX4 BN4 100)
    #f)

  (let-syntax ((test (make-test - $sub-fixnum-ratnum)))
    (test FX1 RN01 122/123)
    (test FX2 RN01 -124/123)
    (test FX3 RN01 66035122052/123)
    (test FX4 RN01 -66035122177/123)
    (test FX1 RN02 124/123)
    (test FX2 RN02 -122/123)
    (test FX3 RN02 66035122054/123)
    (test FX4 RN02 -66035122175/123)
    (test FX1 RN03 124/123)
    (test FX2 RN03 -122/123)
    (test FX3 RN03 66035122054/123)
    (test FX4 RN03 -66035122175/123)
    (test FX1 RN04 536871035/123)
    (test FX2 RN04 536870789/123)
    (test FX3 RN04 66571992965/123)
    (test FX4 RN04 -65498251264/123)
    #f)

  (let-syntax ((test (make-flonum-test - $sub-fixnum-flonum)))
    (test FX1 FL1 1.0)
    (test FX2 FL1 -1.0)
    (test FX3 FL1 536870911.0)
    (test FX4 FL1 -536870912.0)
    (test FX1 FL2 1.0)
    (test FX2 FL2 -1.0)
    (test FX3 FL2 536870911.0)
    (test FX4 FL2 -536870912.0)
    (test FX1 FL3 -1.1230000000000002)
    (test FX2 FL3 -3.123)
    (test FX3 FL3 536870908.877)
    (test FX4 FL3 -536870914.123)
    (test FX1 FL4 3.123)
    (test FX2 FL4 1.1230000000000002)
    (test FX3 FL4 536870913.123)
    (test FX4 FL4 -536870909.877)
    #f)

  (let-syntax ((test (make-cflonum-test - $sub-fixnum-cflonum)))
    (test FX1 CFL01 1.0-0.0i)
    (test FX2 CFL01 -1.0-0.0i)
    (test FX3 CFL01 536870911.0-0.0i)
    (test FX4 CFL01 -536870912.0-0.0i)
    (test FX1 CFL02 1.0-0.0i)
    (test FX2 CFL02 -1.0-0.0i)
    (test FX3 CFL02 536870911.0-0.0i)
    (test FX4 CFL02 -536870912.0-0.0i)
    (test FX1 CFL03 1.0+0.0i)
    (test FX2 CFL03 -1.0+0.0i)
    (test FX3 CFL03 536870911.0+0.0i)
    (test FX4 CFL03 -536870912.0+0.0i)
    (test FX1 CFL04 1.0+0.0i)
    (test FX2 CFL04 -1.0+0.0i)
    (test FX3 CFL04 536870911.0+0.0i)
    (test FX4 CFL04 -536870912.0+0.0i)
    (test FX1 CFL05 2.2+0.0i)
    (test FX2 CFL05 0.19999999999999996+0.0i)
    (test FX3 CFL05 536870912.2+0.0i)
    (test FX4 CFL05 -536870910.8+0.0i)
    (test FX1 CFL06 2.2-0.0i)
    (test FX2 CFL06 0.19999999999999996-0.0i)
    (test FX3 CFL06 536870912.2-0.0i)
    (test FX4 CFL06 -536870910.8-0.0i)
    (test FX1 CFL07 1.0+1.2i)
    (test FX2 CFL07 -1.0+1.2i)
    (test FX3 CFL07 536870911.0+1.2i)
    (test FX4 CFL07 -536870912.0+1.2i)
    (test FX1 CFL08 1.0+1.2i)
    (test FX2 CFL08 -1.0+1.2i)
    (test FX3 CFL08 536870911.0+1.2i)
    (test FX4 CFL08 -536870912.0+1.2i)
    (test FX1 CFL09 2.2+inf.0i)
    (test FX1 CFL10 2.2-inf.0i)
    (test FX1 CFL11 -inf.0+1.2i)
    (test FX1 CFL12 +inf.0+1.2i)
    (test FX1 CFL13 2.2+nan.0i)
    (test FX1 CFL14 2.2+nan.0i)
    (test FX1 CFL15 +nan.0+1.2i)
    (test FX1 CFL16 +nan.0+1.2i)
    #f)

  (let-syntax ((test (make-test - $sub-fixnum-compnum)))
    (test 1	10+20i				(C (- 1 10) (- 20)))
    (test 1	1+20.0i				(C (- 1 1)  (- 20.0)))
    (test 1	10.0+2i				(C (- 1 10.0) (- 2)))
    (test 1	1/2+20i				(C (- 1 1/2) (- 20)))
    (test 1	10+2/3i				(C (- 1 10) (- 2/3)))
    (test 1	(C BN1 20)	(C (- 1 BN1) (- 20)))
    (test 1	(C 10 BN1)	(C (- 1 10) (- BN1)))
    #f)

  #t)


(parametrise ((check-test-name	'bignums))

  (let-syntax ((test (make-test - $sub-bignum-fixnum)))
    (test BN1 FX1 536870911)
    (test BN2 FX1 536871010)
    (test BN3 FX1 -536870914)
    (test BN4 FX1 -536871013)
    (test BN1 FX2 536870913)
    (test BN2 FX2 536871012)
    (test BN3 FX2 -536870912)
    (test BN4 FX2 -536871011)
    (test BN1 FX3 1)
    (test BN2 FX3 100)
    (test BN3 FX3 -1073741824)
    (test BN4 FX3 -1073741923)
    (test BN1 FX4 1073741824)
    (test BN2 FX4 1073741923)
    (test BN3 FX4 -1)
    (test BN4 FX4 -100)
    #f)

  (let-syntax ((test (make-test - $sub-bignum-bignum)))
    (test BN1 BN1 0)
    (test BN2 BN1 99)
    (test BN3 BN1 -1073741825)
    (test BN4 BN1 -1073741924)
    (test BN1 BN2 -99)
    (test BN2 BN2 0)
    (test BN3 BN2 -1073741924)
    (test BN4 BN2 -1073742023)
    (test BN1 BN3 1073741825)
    (test BN2 BN3 1073741924)
    (test BN3 BN3 0)
    (test BN4 BN3 -99)
    (test BN1 BN4 1073741924)
    (test BN2 BN4 1073742023)
    (test BN3 BN4 99)
    (test BN4 BN4 0)
    #f)

  (let-syntax ((test (make-test - $sub-bignum-ratnum)))
    (test BN1 RN01 66035122175/123)
    (test BN2 RN01 66035134352/123)
    (test BN3 RN01 -66035122300/123)
    (test BN4 RN01 -66035134477/123)
    (test BN1 RN02 66035122177/123)
    (test BN2 RN02 66035134354/123)
    (test BN3 RN02 -66035122298/123)
    (test BN4 RN02 -66035134475/123)
    (test BN1 RN03 66035122177/123)
    (test BN2 RN03 66035134354/123)
    (test BN3 RN03 -66035122298/123)
    (test BN4 RN03 -66035134475/123)
    (test BN1 RN04 66571993088/123)
    (test BN2 RN04 66572005265/123)
    (test BN3 RN04 -65498251387/123)
    (test BN4 RN04 -65498263564/123)
    #f)

  (let-syntax ((test (make-flonum-test - $sub-bignum-flonum)))
    (test BN1 FL1 536870912.0)
    (test BN2 FL1 536871011.0)
    (test BN3 FL1 -536870913.0)
    (test BN4 FL1 -536871012.0)
    (test BN1 FL2 536870912.0)
    (test BN2 FL2 536871011.0)
    (test BN3 FL2 -536870913.0)
    (test BN4 FL2 -536871012.0)
    (test BN1 FL3 536870909.877)
    (test BN2 FL3 536871008.877)
    (test BN3 FL3 -536870915.123)
    (test BN4 FL3 -536871014.123)
    (test BN1 FL4 536870914.123)
    (test BN2 FL4 536871013.123)
    (test BN3 FL4 -536870910.877)
    (test BN4 FL4 -536871009.877)
    #f)

  (let-syntax ((test (make-cflonum-test - $sub-bignum-cflonum)))
    (test BN1 CFL01 536870912.0-0.0i)
    (test BN2 CFL01 536871011.0-0.0i)
    (test BN3 CFL01 -536870913.0-0.0i)
    (test BN4 CFL01 -536871012.0-0.0i)
    (test BN1 CFL02 536870912.0-0.0i)
    (test BN2 CFL02 536871011.0-0.0i)
    (test BN3 CFL02 -536870913.0-0.0i)
    (test BN4 CFL02 -536871012.0-0.0i)
    (test BN1 CFL03 536870912.0+0.0i)
    (test BN2 CFL03 536871011.0+0.0i)
    (test BN3 CFL03 -536870913.0+0.0i)
    (test BN4 CFL03 -536871012.0+0.0i)
    (test BN1 CFL04 536870912.0+0.0i)
    (test BN2 CFL04 536871011.0+0.0i)
    (test BN3 CFL04 -536870913.0+0.0i)
    (test BN4 CFL04 -536871012.0+0.0i)
    (test BN1 CFL05 536870913.2+0.0i)
    (test BN2 CFL05 536871012.2+0.0i)
    (test BN3 CFL05 -536870911.8+0.0i)
    (test BN4 CFL05 -536871010.8+0.0i)
    (test BN1 CFL06 536870913.2-0.0i)
    (test BN2 CFL06 536871012.2-0.0i)
    (test BN3 CFL06 -536870911.8-0.0i)
    (test BN4 CFL06 -536871010.8-0.0i)
    (test BN1 CFL07 536870912.0+1.2i)
    (test BN2 CFL07 536871011.0+1.2i)
    (test BN3 CFL07 -536870913.0+1.2i)
    (test BN4 CFL07 -536871012.0+1.2i)
    (test BN1 CFL08 536870912.0+1.2i)
    (test BN2 CFL08 536871011.0+1.2i)
    (test BN3 CFL08 -536870913.0+1.2i)
    (test BN4 CFL08 -536871012.0+1.2i)
    (test BN1 CFL09 536870913.2+inf.0i)
    (test BN1 CFL10 536870913.2-inf.0i)
    (test BN1 CFL11 -inf.0+1.2i)
    (test BN1 CFL12 +inf.0+1.2i)
    (test BN1 CFL13 536870913.2+nan.0i)
    (test BN1 CFL14 536870913.2+nan.0i)
    (test BN1 CFL15 +nan.0+1.2i)
    (test BN1 CFL16 +nan.0+1.2i)
    #f)

  (let-syntax ((test (make-test - $sub-bignum-compnum)))
    (test BN1	10+20i				(C (- BN1 10) (- 20)))
    (test BN1	1+20.0i				(C (- BN1 1)  (- 20.0)))
    (test BN1	10.0+2i				(C (- BN1 10.0) (- 2)))
    (test BN1	1/2+20i				(C (- BN1 1/2) (- 20)))
    (test BN1	10+2/3i				(C (- BN1 10) (- 2/3)))
    (test BN1	(C BN2 20)	(C (- BN1 BN2) (- 20)))
    (test BN1	(C 10 BN2)	(C (- BN1 10) (- BN2)))
    #f)

  #t)


(parametrise ((check-test-name	'ratnums))

  (let-syntax ((test (make-test - $sub-ratnum-fixnum)))
    (test 1/2 0 1/2)
    (test 1/2 10 -19/2)
    (test 1/2 (greatest-fixnum) -1073741821/2)
    (test 1/2 (least-fixnum) 1073741825/2)
    #f)

  (let-syntax ((test (make-test - $sub-ratnum-bignum)))
    (test 1/2 BN1 -1073741823/2)
    (test 1/2 BN2 -1073742021/2)
    (test 1/2 BN3 1073741827/2)
    (test 1/2 BN4 1073742025/2)
    (test -1/2 BN1 -1073741825/2)
    (test -1/2 BN2 -1073742023/2)
    (test -1/2 BN3 1073741825/2)
    (test -1/2 BN4 1073742023/2)
    #f)

  (let-syntax ((test (make-test - $sub-ratnum-ratnum)))
    (test 1/2 3/4 -1/4)
    (test -1/2 3/4 -5/4)
    (test -1/2 -3/4 1/4)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-ratnum-flonum)))
    (test 1/2 3.4 -2.9)
    (test -1/2 3.4 -3.9)
    (test RN01 FL1 0.008130081300813009)
    (test RN02 FL1 -0.008130081300813009)
    (test RN03 FL1 -0.008130081300813009)
    (test RN04 FL1 -4364804.1626016265)
    (test RN01 FL2 0.008130081300813009)
    (test RN02 FL2 -0.008130081300813009)
    (test RN03 FL2 -0.008130081300813009)
    (test RN04 FL2 -4364804.1626016265)
    (test RN01 FL3 -2.114869918699187)
    (test RN02 FL3 -2.1311300813008134)
    (test RN03 FL3 -2.1311300813008134)
    (test RN04 FL3 -4364806.285601626)
    (test RN01 FL4 2.1311300813008134)
    (test RN02 FL4 2.114869918699187)
    (test RN03 FL4 2.114869918699187)
    (test RN04 FL4 -4364802.039601627)
    #f)

  (let-syntax ((test (make-cflonum-test - $sub-ratnum-cflonum)))
    (test RN01 CFL01 0.008130081300813009-0.0i)
    (test RN02 CFL01 -0.008130081300813009-0.0i)
    (test RN03 CFL01 -0.008130081300813009-0.0i)
    (test RN04 CFL01 -4364804.1626016265-0.0i)
    (test RN01 CFL02 0.008130081300813009-0.0i)
    (test RN02 CFL02 -0.008130081300813009-0.0i)
    (test RN03 CFL02 -0.008130081300813009-0.0i)
    (test RN04 CFL02 -4364804.1626016265-0.0i)
    (test RN01 CFL03 0.008130081300813009+0.0i)
    (test RN02 CFL03 -0.008130081300813009+0.0i)
    (test RN03 CFL03 -0.008130081300813009+0.0i)
    (test RN04 CFL03 -4364804.1626016265+0.0i)
    (test RN01 CFL04 0.008130081300813009+0.0i)
    (test RN02 CFL04 -0.008130081300813009+0.0i)
    (test RN03 CFL04 -0.008130081300813009+0.0i)
    (test RN04 CFL04 -4364804.1626016265+0.0i)
    (test RN01 CFL05 1.208130081300813+0.0i)
    (test RN02 CFL05 1.191869918699187+0.0i)
    (test RN03 CFL05 1.191869918699187+0.0i)
    (test RN04 CFL05 -4364802.962601626+0.0i)
    (test RN01 CFL06 1.208130081300813-0.0i)
    (test RN02 CFL06 1.191869918699187-0.0i)
    (test RN03 CFL06 1.191869918699187-0.0i)
    (test RN04 CFL06 -4364802.962601626-0.0i)
    (test RN01 CFL07 0.008130081300813009+1.2i)
    (test RN02 CFL07 -0.008130081300813009+1.2i)
    (test RN03 CFL07 -0.008130081300813009+1.2i)
    (test RN04 CFL07 -4364804.1626016265+1.2i)
    (test RN01 CFL08 0.008130081300813009+1.2i)
    (test RN02 CFL08 -0.008130081300813009+1.2i)
    (test RN03 CFL08 -0.008130081300813009+1.2i)
    (test RN04 CFL08 -4364804.1626016265+1.2i)
    (test RN01 CFL09 1.208130081300813+inf.0i)
    (test RN01 CFL10 1.208130081300813-inf.0i)
    (test RN01 CFL11 -inf.0+1.2i)
    (test RN01 CFL12 +inf.0+1.2i)
    (test RN01 CFL13 1.208130081300813+nan.0i)
    (test RN01 CFL14 1.208130081300813+nan.0i)
    (test RN01 CFL15 +nan.0+1.2i)
    (test RN01 CFL16 +nan.0+1.2i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-ratnum-compnum)))
    (test RN01 10+20i				(C (- RN01 10) (- 20)))
    (test RN01 1+20.0i				(C (- RN01 1) (- 20.0)))
    (test RN01 10.0+2i				(C (- RN01 10.0) (- 2)))
    (test RN01 1/2+20i				(C (- RN01 1/2) (- 20)))
    (test RN01 10+2/3i				(C (- RN01 10) (- 2/3)))
    (test RN01 (C RN02 20)	(C (- RN01 RN02) (- 20)))
    (test RN01 (C 10 RN02)	(C (- RN01 10) (- RN02)))
    #f)

  #t)


(parametrise ((check-test-name	'flonums))

  (let-syntax ((test (make-test - $sub-flonum-fixnum)))
    (test FL1 FX1 -1.0)
    (test FL2 FX1 -1.0)
    (test FL3 FX1 1.1230000000000002)
    (test FL4 FX1 -3.123)
    (test FL1 FX2 1.0)
    (test FL2 FX2 1.0)
    (test FL3 FX2 3.123)
    (test FL4 FX2 -1.1230000000000002)
    (test FL1 FX3 -536870911.0)
    (test FL2 FX3 -536870911.0)
    (test FL3 FX3 -536870908.877)
    (test FL4 FX3 -536870913.123)
    (test FL1 FX4 536870912.0)
    (test FL2 FX4 536870912.0)
    (test FL3 FX4 536870914.123)
    (test FL4 FX4 536870909.877)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-flonum-bignum)))
    (test FL1 BN1 -536870912.0)
    (test FL2 BN1 -536870912.0)
    (test FL3 BN1 -536870909.877)
    (test FL4 BN1 -536870914.123)
    (test FL1 BN2 -536871011.0)
    (test FL2 BN2 -536871011.0)
    (test FL3 BN2 -536871008.877)
    (test FL4 BN2 -536871013.123)
    (test FL1 BN3 536870913.0)
    (test FL2 BN3 536870913.0)
    (test FL3 BN3 536870915.123)
    (test FL4 BN3 536870910.877)
    (test FL1 BN4 536871012.0)
    (test FL2 BN4 536871012.0)
    (test FL3 BN4 536871014.123)
    (test FL4 BN4 536871009.877)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-flonum-ratnum)))
    (test FL1 RN01 -0.008130081300813009)
    (test FL2 RN01 -0.008130081300813009)
    (test FL3 RN01 2.114869918699187)
    (test FL4 RN01 -2.1311300813008134)
    (test FL1 RN02 0.008130081300813009)
    (test FL2 RN02 0.008130081300813009)
    (test FL3 RN02 2.1311300813008134)
    (test FL4 RN02 -2.114869918699187)
    (test FL1 RN03 0.008130081300813009)
    (test FL2 RN03 0.008130081300813009)
    (test FL3 RN03 2.1311300813008134)
    (test FL4 RN03 -2.114869918699187)
    (test FL1 RN04 4364804.1626016265)
    (test FL2 RN04 4364804.1626016265)
    (test FL3 RN04 4364806.285601626)
    (test FL4 RN04 4364802.039601627)
    #f)

  (let-syntax ((test (make-flonum-test - $sub-flonum-flonum)))
    (test FL1 FL1 0.0)
    (test FL2 FL1 -0.0)
    (test FL3 FL1 2.123)
    (test FL4 FL1 -2.123)
    (test FL1 FL2 0.0)
    (test FL2 FL2 0.0)
    (test FL3 FL2 2.123)
    (test FL4 FL2 -2.123)
    (test FL1 FL3 -2.123)
    (test FL2 FL3 -2.123)
    (test FL3 FL3 0.0)
    (test FL4 FL3 -4.246)
    (test FL1 FL4 2.123)
    (test FL2 FL4 2.123)
    (test FL3 FL4 4.246)
    (test FL4 FL4 0.0)
    #f)

  (let-syntax ((test (make-cflonum-test - $sub-flonum-cflonum)))
    (test FL1 CFL01 0.0-0.0i)
    (test FL2 CFL01 -0.0-0.0i)
    (test FL3 CFL01 2.123-0.0i)
    (test FL4 CFL01 -2.123-0.0i)
    (test FL1 CFL02 0.0-0.0i)
    (test FL2 CFL02 0.0-0.0i)
    (test FL3 CFL02 2.123-0.0i)
    (test FL4 CFL02 -2.123-0.0i)
    (test FL1 CFL03 0.0+0.0i)
    (test FL2 CFL03 -0.0+0.0i)
    (test FL3 CFL03 2.123+0.0i)
    (test FL4 CFL03 -2.123+0.0i)
    (test FL1 CFL04 0.0+0.0i)
    (test FL2 CFL04 0.0+0.0i)
    (test FL3 CFL04 2.123+0.0i)
    (test FL4 CFL04 -2.123+0.0i)
    (test FL1 CFL05 1.2+0.0i)
    (test FL2 CFL05 1.2+0.0i)
    (test FL3 CFL05 3.3230000000000004+0.0i)
    (test FL4 CFL05 -0.9230000000000003+0.0i)
    (test FL1 CFL06 1.2-0.0i)
    (test FL2 CFL06 1.2-0.0i)
    (test FL3 CFL06 3.3230000000000004-0.0i)
    (test FL4 CFL06 -0.9230000000000003-0.0i)
    (test FL1 CFL07 0.0+1.2i)
    (test FL2 CFL07 -0.0+1.2i)
    (test FL3 CFL07 2.123+1.2i)
    (test FL4 CFL07 -2.123+1.2i)
    (test FL1 CFL08 0.0+1.2i)
    (test FL2 CFL08 0.0+1.2i)
    (test FL3 CFL08 2.123+1.2i)
    (test FL4 CFL08 -2.123+1.2i)
    (test FL1 CFL09 1.2+inf.0i)
    (test FL1 CFL10 1.2-inf.0i)
    (test FL1 CFL11 -inf.0+1.2i)
    (test FL1 CFL12 +inf.0+1.2i)
    (test FL1 CFL13 1.2+nan.0i)
    (test FL1 CFL14 1.2+nan.0i)
    (test FL1 CFL15 +nan.0+1.2i)
    (test FL1 CFL16 +nan.0+1.2i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-flonum-compnum)))
    (test FL1 10+20i				(C (- FL1 10) (- 20)))
    (test FL1 1+20.0i				(C (- FL1 1) (- 20.0)))
    (test FL1 10.0+2i				(C (- FL1 10.0) (- 2)))
    (test FL1 1/2+20i				(C (- FL1 1/2) (- 20)))
    (test FL1 10+2/3i				(C (- FL1 10) (- 2/3)))
    (test FL1 (C RN02 20)	(C (- FL1 RN02) (- 20)))
    (test FL1 (C 10 RN02)	(C (- FL1 10) (- RN02)))
    #f)

  #t)


(parametrise ((check-test-name	'cflonums))

  (let-syntax ((test (make-inexact-test - $sub-cflonum-fixnum)))
    (test CFL01 FX1 -1.0+0.0i)
    (test CFL02 FX1 -1.0+0.0i)
    (test CFL03 FX1 -1.0-0.0i)
    (test CFL04 FX1 -1.0-0.0i)
    (test CFL01 FX2 1.0+0.0i)
    (test CFL02 FX2 1.0+0.0i)
    (test CFL03 FX2 1.0-0.0i)
    (test CFL04 FX2 1.0-0.0i)
    (test CFL01 FX3 -536870911.0+0.0i)
    (test CFL02 FX3 -536870911.0+0.0i)
    (test CFL03 FX3 -536870911.0-0.0i)
    (test CFL04 FX3 -536870911.0-0.0i)
    (test CFL01 FX4 536870912.0+0.0i)
    (test CFL02 FX4 536870912.0+0.0i)
    (test CFL03 FX4 536870912.0-0.0i)
    (test CFL04 FX4 536870912.0-0.0i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-cflonum-bignum)))
    (test CFL01 BN1 -536870912.0+0.0i)
    (test CFL02 BN1 -536870912.0+0.0i)
    (test CFL03 BN1 -536870912.0-0.0i)
    (test CFL04 BN1 -536870912.0-0.0i)
    (test CFL01 BN2 -536871011.0+0.0i)
    (test CFL02 BN2 -536871011.0+0.0i)
    (test CFL03 BN2 -536871011.0-0.0i)
    (test CFL04 BN2 -536871011.0-0.0i)
    (test CFL01 BN3 536870913.0+0.0i)
    (test CFL02 BN3 536870913.0+0.0i)
    (test CFL03 BN3 536870913.0-0.0i)
    (test CFL04 BN3 536870913.0-0.0i)
    (test CFL01 BN4 536871012.0+0.0i)
    (test CFL02 BN4 536871012.0+0.0i)
    (test CFL03 BN4 536871012.0-0.0i)
    (test CFL04 BN4 536871012.0-0.0i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-cflonum-ratnum)))
    (test CFL01 RN01 -0.008130081300813009+0.0i)
    (test CFL02 RN01 -0.008130081300813009+0.0i)
    (test CFL03 RN01 -0.008130081300813009-0.0i)
    (test CFL04 RN01 -0.008130081300813009-0.0i)
    (test CFL01 RN02 0.008130081300813009+0.0i)
    (test CFL02 RN02 0.008130081300813009+0.0i)
    (test CFL03 RN02 0.008130081300813009-0.0i)
    (test CFL04 RN02 0.008130081300813009-0.0i)
    (test CFL01 RN03 0.008130081300813009+0.0i)
    (test CFL02 RN03 0.008130081300813009+0.0i)
    (test CFL03 RN03 0.008130081300813009-0.0i)
    (test CFL04 RN03 0.008130081300813009-0.0i)
    (test CFL01 RN04 4364804.1626016265+0.0i)
    (test CFL02 RN04 4364804.1626016265+0.0i)
    (test CFL03 RN04 4364804.1626016265-0.0i)
    (test CFL04 RN04 4364804.1626016265-0.0i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-cflonum-flonum)))
    (test CFL01 FL1 0.0+0.0i)
    (test CFL02 FL1 -0.0+0.0i)
    (test CFL03 FL1 0.0-0.0i)
    (test CFL04 FL1 -0.0-0.0i)
    (test CFL01 FL2 0.0+0.0i)
    (test CFL02 FL2 0.0+0.0i)
    (test CFL03 FL2 0.0-0.0i)
    (test CFL04 FL2 0.0-0.0i)
    (test CFL01 FL3 -2.123+0.0i)
    (test CFL02 FL3 -2.123+0.0i)
    (test CFL03 FL3 -2.123-0.0i)
    (test CFL04 FL3 -2.123-0.0i)
    (test CFL01 FL4 2.123+0.0i)
    (test CFL02 FL4 2.123+0.0i)
    (test CFL03 FL4 2.123-0.0i)
    (test CFL04 FL4 2.123-0.0i)
    #f)

  (let-syntax ((test (make-cflonum-test - $sub-cflonum-cflonum)))
    (test CFL01 CFL01 0.0+0.0i)
    (test CFL02 CFL01 -0.0+0.0i)
    (test CFL03 CFL01 0.0-0.0i)
    (test CFL04 CFL01 -0.0-0.0i)
    (test CFL01 CFL02 0.0+0.0i)
    (test CFL02 CFL02 0.0+0.0i)
    (test CFL03 CFL02 0.0-0.0i)
    (test CFL04 CFL02 0.0-0.0i)
    (test CFL01 CFL03 0.0+0.0i)
    (test CFL02 CFL03 -0.0+0.0i)
    (test CFL03 CFL03 0.0+0.0i)
    (test CFL04 CFL03 -0.0+0.0i)
    (test CFL01 CFL04 0.0+0.0i)
    (test CFL02 CFL04 0.0+0.0i)
    (test CFL03 CFL04 0.0+0.0i)
    (test CFL04 CFL04 0.0+0.0i)
    (test CFL01 CFL05 1.2+0.0i)
    (test CFL02 CFL05 1.2+0.0i)
    (test CFL03 CFL05 1.2+0.0i)
    (test CFL04 CFL05 1.2+0.0i)
    (test CFL01 CFL06 1.2+0.0i)
    (test CFL02 CFL06 1.2+0.0i)
    (test CFL03 CFL06 1.2-0.0i)
    (test CFL04 CFL06 1.2-0.0i)
    (test CFL01 CFL07 0.0+1.2i)
    (test CFL02 CFL07 -0.0+1.2i)
    (test CFL03 CFL07 0.0+1.2i)
    (test CFL04 CFL07 -0.0+1.2i)
    (test CFL01 CFL08 0.0+1.2i)
    (test CFL02 CFL08 0.0+1.2i)
    (test CFL03 CFL08 0.0+1.2i)
    (test CFL04 CFL08 0.0+1.2i)
    (test CFL01 CFL09 1.2+inf.0i)
    (test CFL01 CFL10 1.2-inf.0i)
    (test CFL01 CFL11 -inf.0+1.2i)
    (test CFL01 CFL12 +inf.0+1.2i)
    (test CFL01 CFL13 1.2+nan.0i)
    (test CFL01 CFL14 1.2+nan.0i)
    (test CFL01 CFL15 +nan.0+1.2i)
    (test CFL01 CFL16 +nan.0+1.2i)
    #f)

  (let-syntax ((test (make-inexact-test - $sub-cflonum-compnum)))
    (test CFL01 10+20i				(C (- (R CFL01) 10)
								  (- (I CFL01) 20)))
    (test CFL01 1+20.0i				(C (- (R CFL01) 1)
								  (- (I CFL01) 20.0)))
    (test CFL01 10.0+2i				(C (- (R CFL01) 10.0)
								  (- (I CFL01) 2)))
    (test CFL01 1/2+20i				(C (- (R CFL01) 1/2)
								  (- (I CFL01) 20)))
    (test CFL01 10+2/3i				(C (- (R CFL01) 10)
								  (- (I CFL01) 2/3)))
    (test CFL01 (C RN02 20)	(C (- (R CFL01) RN02)
								  (- (I CFL01) 20)))
    (test CFL01 (C 10 RN02)	(C (- (R CFL01) 10)
								  (- (I CFL01) RN02)))
    #f)

  #t)


(parametrise ((check-test-name	'compnums))

  (letrec-syntax ((test1 (make-test - $sub-compnum-fixnum))
		  (test (syntax-rules ()
			  ((_ ?op1 ?op2)
			   (test1 ?op1 ?op2 (C (- (R ?op1) (R ?op2))
					       (- (I ?op1) (I ?op2))))))))
    (test 10+20i	1)
    (test 1.0+20.0i	1)
    (test 10.0+2.0i	1)
    (test 1/2+20i	1)
    (test 10+2/3i	1)
    (test (C BN1 20)	1)
    (test (C 10 BN1)	1)
    #f)

  (letrec-syntax ((test1 (make-test - $sub-compnum-bignum))
		  (test (syntax-rules ()
			  ((_ ?op1 ?op2)
			   (test1 ?op1 ?op2 (C (- (R ?op1) (R ?op2))
					       (- (I ?op1) (I ?op2))))))))
    (test 10+20i	BN1)
    (test 1.0+20.0i	BN1)
    (test 10.0+2.0i	BN1)
    (test 1/2+20i	BN1)
    (test 10+2/3i	BN1)
    (test (C BN2 20)	BN1)
    (test (C 10 BN2)	BN1)
    #f)

  (letrec-syntax ((test1 (make-test - $sub-compnum-ratnum))
		  (test (syntax-rules ()
			  ((_ ?op1 ?op2)
			   (test1 ?op1 ?op2 (C (- (R ?op1) (R ?op2))
					       (- (I ?op1) (I ?op2))))))))
    (test 10+20i	RN01)
    (test 1+20.0i	RN01)
    (test 10.0+2.0i	RN01)
    (test 1/2+20i	RN01)
    (test 10+2/3i	RN01)
    (test (C RN02 20)	RN01)
    (test (C 10 RN02)	RN01)
    #f)

  (letrec-syntax ((test1 (make-test - $sub-compnum-flonum))
		  (test (syntax-rules ()
			  ((_ ?op1 ?op2)
			   (test1 ?op1 ?op2 (C (- (R ?op1) (R ?op2))
					       (- (I ?op1) (I ?op2))))))))
    (test 10+20i	FL1)
    (test 1+20.0i	FL1)
    (test 10.0+2i	FL1)
    (test 1.0+20.0i	FL1)
    (test 10.0+2.0i	FL1)
    (test 1/2+20i	FL1)
    (test 10+2/3i	FL1)
    (test (C BN2 20)	FL1)
    (test (C 10 BN2)	FL1)
    #f)

  (letrec-syntax ((test1 (make-test - $sub-compnum-cflonum))
		  (test (syntax-rules ()
			  ((_ ?op1 ?op2)
			   (test1 ?op1 ?op2 (C (- (R ?op1) (R ?op2))
					       (- (I ?op1) (I ?op2))))))))
    (test 10+20i	CFL01)
    (test 1.0+20.0i	CFL01)
    (test 10.0+2.0i	CFL01)
    (test 1/2+20i	CFL01)
    (test 10+2/3i	CFL01)
    (test (C BN2 20)	CFL01)
    (test (C 10 BN2)	CFL01)
    #f)

  #t)


;;;; done

(check-report)

;;; end of file
